<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Session</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" class="circular-icon" type="image/png" href="../../../../../images/logo.png">

    <style>
        /* Style for the main iframe video */
        .video-container {
            max-width: 800px;
            width: 100%;
            aspect-ratio: 16 / 9;
            overflow: hidden;
            margin: 20px auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Control button styling */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .controls button {
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #008080;
            color: #FFFFE0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .controls button:hover {
            background-color: #006666;
        }
        
        .controls button.pdf-btn {
            background-color: #FF6347;
        }
        
        .controls button.pdf-btn:hover {
            background-color: #FF4500;
        }
        
        h1 {
            font-size: 28px;
            text-align: center;
            margin-top: 20px;
            color: #008080;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            font-family: Arial, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .error-message {
            text-align: center;
            color: #ff0000;
            font-size: 20px;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <h1 id="sessionTitle">Loading...</h1>
    <div class="video-container">
        <iframe id="videoFrame" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
    </div>
    <div class="controls">
        <button onclick="toggleFullscreen()">Fullscreen</button>
        <button id="homeworkBtn" onclick="goToHomework()" style="display: none;">Homework Video</button>
        <button id="pdfBtn" onclick="downloadPDF()" style="display: none;" class="pdf-btn"><i class="fas fa-file-pdf"></i> Download PDF</button>
        <button onclick="location.href = '../sessions'">Back to Sessions</button>
    </div>
    <script>    
        // Session data configuration
        const sessions = {
            1: {
                title: "Introduction to Calculus",
                videoUrl: "YOUR_VIDEO_URL_1",
                scriptUrl: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_1/exec",
                homeworkUrl: "YOUR_HOMEWORK_VIDEO_URL_1",
                pdfUrl: "YOUR_PDF_URL_1"
            },
            2: {
                title: "Derivatives and Differentiation",
                videoUrl: "YOUR_VIDEO_URL_2",
                scriptUrl: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_2/exec",
                homeworkUrl: "YOUR_HOMEWORK_VIDEO_URL_2",
                pdfUrl: "YOUR_PDF_URL_2"
            },
            3: {
                title: "Integration Techniques",
                videoUrl: "YOUR_VIDEO_URL_3",
                scriptUrl: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_3/exec",
                homeworkUrl: "YOUR_HOMEWORK_VIDEO_URL_3",
                pdfUrl: "YOUR_PDF_URL_3"
            },
            4: {
                title: "Applications of Integration",
                videoUrl: "YOUR_VIDEO_URL_4",
                scriptUrl: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_4/exec",
                homeworkUrl: "YOUR_HOMEWORK_VIDEO_URL_4",
                pdfUrl: "YOUR_PDF_URL_4"
            },
            5: {
                title: "Trigonometric Functions",
                videoUrl: "YOUR_VIDEO_URL_5",
                scriptUrl: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_5/exec",
                homeworkUrl: "YOUR_HOMEWORK_VIDEO_URL_5",
                pdfUrl: "YOUR_PDF_URL_5"
            },
            6: {
                title: "Limits and Continuity",
                videoUrl: "YOUR_VIDEO_URL_6",
                scriptUrl: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_6/exec",
                homeworkUrl: "YOUR_HOMEWORK_VIDEO_URL_6",
                pdfUrl: "YOUR_PDF_URL_6"
            }
        };

        // Get session number from URL parameter
        function getSessionNumber() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('session');
        }

        // Get video type from URL parameter (lecture or homework)
        function getVideoType() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('type') || 'lecture';
        }

        // Toggle fullscreen mode for the video container
        function toggleFullscreen() {
            const videoContainer = document.querySelector('.video-container');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                videoContainer.requestFullscreen();
            }
        }

        // Navigate to homework video
        function goToHomework() {
            const sessionNumber = getSessionNumber();
            window.location.href = `session.html?session=${sessionNumber}&type=homework`;
        }

        // Download PDF
        function downloadPDF() {
            const sessionNumber = getSessionNumber();
            const session = sessions[sessionNumber];
            if (session && session.pdfUrl && !session.pdfUrl.includes('YOUR_PDF_URL')) {
                window.open(session.pdfUrl, '_blank');
            } else {
                alert('PDF not available for this session.');
            }
        }

        // Load session based on URL parameter
        function loadSession() {
            const sessionNumber = getSessionNumber();
            const videoType = getVideoType();
            
            console.log("Loading session:", sessionNumber, "Type:", videoType);
            
            if (!sessionNumber || !sessions[sessionNumber]) {
                document.getElementById('sessionTitle').textContent = 'Invalid Session';
                document.querySelector('.video-container').innerHTML = '<div class="error-message">Session not found. Please return to sessions page.</div>';
                return;
            }

            const session = sessions[sessionNumber];
            
            // Determine which video to show
            let videoUrl = session.videoUrl;
            let titleSuffix = '';
            
            if (videoType === 'homework' && session.homeworkUrl) {
                videoUrl = session.homeworkUrl;
                titleSuffix = ' - Homework';
            }
            
            // Update title
            document.getElementById('sessionTitle').textContent = session.title + titleSuffix;
            document.title = `Math Session ${sessionNumber}${titleSuffix}`;
            
            // Show homework button only if homework exists and we're viewing lecture
            const homeworkBtn = document.getElementById('homeworkBtn');
            if (videoType !== 'homework' && session.homeworkUrl) {
                homeworkBtn.style.display = 'inline-block';
                console.log("Homework button shown");
            } else {
                homeworkBtn.style.display = 'none';
            }
            
            // Show PDF button only if PDF exists
            const pdfBtn = document.getElementById('pdfBtn');
            if (session.pdfUrl && !session.pdfUrl.includes('YOUR_PDF_URL')) {
                pdfBtn.style.display = 'inline-block';
                console.log("PDF button shown");
            } else {
                pdfBtn.style.display = 'none';
            }
            
            // Demo mode - show placeholder if URL not configured
            if (videoUrl.includes('YOUR_VIDEO_URL') || videoUrl.includes('YOUR_HOMEWORK')) {
                document.getElementById('videoFrame').src = "https://www.youtube.com/embed/dQw4w9WgXcQ";
                console.log("Demo mode: Using placeholder video");
            } else {
                document.getElementById('videoFrame').src = videoUrl;
            }

            // Check authentication (only if not in demo mode)
            const phone = localStorage.getItem('userPhone');
            if (!phone) {
                console.log("Demo mode: No authentication, viewing as guest");
                return;
            }

            // Verify subscription (skip if placeholder URL)
            if (!session.scriptUrl.includes('YOUR_SCRIPT_URL')) {
                fetch(`${session.scriptUrl}?code=${phone}&session=${sessionNumber}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            location.href = "../../../../login";
                        }
                    })
                    .catch(err => {
                        console.error('Fetch error:', err);
                    });
            } else {
                console.log("Demo mode: Skipping authentication check");
            }
        }
        
        window.onload = loadSession;

    </script>
</body>
</html>
