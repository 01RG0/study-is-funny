<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sessions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> <!-- Font Awesome -->
    <link rel="stylesheet" href="../../../../css/sessions.css">
    <link rel="stylesheet" href="../../../../css/main.css">
    <link rel="icon" class="circular-icon" type="image/png" href="../../../../images/logo.png">
</head>
<body>

    <!-- Header -->
    <header>
        <div class="banner">
            <img src="../../../../images/logo.webp" alt="Website Logo" class="logo">
            <h1>Studyisfunny <i class="fas fa-graduation-cap"></i></h1>
            <a href="https://wa.me/201558145450?text=Hello" target="_blank" class="whatsapp-button">
                <i class="fab fa-whatsapp"></i> WhatsApp
            </a>
        </div>
    </header>

    <!-- Popup Element -->
    <div class="overlay" onclick="closePopup()"></div>
    <div class="popup">
        <div class="popup-header">Subscription Details</div>
        <div class="popup-content">
            <!-- Add your dynamic content here -->
        </div>
        <button class="popup-close" onclick="closePopup()">Close</button>
    </div>
    <!-- Loading Spinner -->
<div class="loading-spinner" id="loadingSpinner">
    <div class="spinner"></div>
</div>

    <!-- Sessions Cards -->
    <section class="sessions-container">
        <!-- Session Cards -->
        <div class="session-card" data-session="1">
            <h3>Introduction to Quantum Mechanics CH:1 L:1</h3>
            <p class="session-date"><i class="fas fa-calendar-alt"></i> Date: September 7, 2025</p>
            <p class="lecture-sequence"><i class="fas fa-play-circle"></i> Lecture: 1</p>
            <a href="#" class="view-details" onclick="handleSessionDetails(1);">View Details</a>
        </div>
        <div class="session-card" data-session="2">
            <h3>Wave-Particle Duality CH:1 L:2</h3>
            <p class="session-date"><i class="fas fa-calendar-alt"></i> Date: September 14, 2025</p>
            <p class="lecture-sequence"><i class="fas fa-play-circle"></i> Lecture: 2</p>
            <a href="#" class="view-details" onclick="handleSessionDetails(2);">View Details</a>
        </div>
        <div class="session-card" data-session="3">
            <h3>Thermodynamics Laws CH:2 L:1</h3>
            <p class="session-date"><i class="fas fa-calendar-alt"></i> Date: September 21, 2025</p>
            <p class="lecture-sequence"><i class="fas fa-play-circle"></i> Lecture: 3</p>
            <a href="#" class="view-details" onclick="handleSessionDetails(3);">View Details</a>
        </div>
        <div class="session-card" data-session="4">
            <h3>Energy Transfer and Entropy CH:2 L:2</h3>
            <p class="session-date"><i class="fas fa-calendar-alt"></i> Date: September 28, 2025</p>
            <p class="lecture-sequence"><i class="fas fa-play-circle"></i> Lecture: 4</p>
            <a href="#" class="view-details" onclick="handleSessionDetails(4);">View Details</a>
        </div>
        <div class="session-card" data-session="5">
            <h3>Electromagnetic Waves CH:3 L:1</h3>
            <p class="session-date"><i class="fas fa-calendar-alt"></i> Date: October 5, 2025</p>
            <p class="lecture-sequence"><i class="fas fa-play-circle"></i> Lecture: 5</p>
            <a href="#" class="view-details" onclick="handleSessionDetails(5);">View Details</a>
        </div>
        <div class="session-card" data-session="6">
            <h3>Maxwell's Equations CH:3 L:2</h3>
            <p class="session-date"><i class="fas fa-calendar-alt"></i> Date: October 12, 2025</p>
            <p class="lecture-sequence"><i class="fas fa-play-circle"></i> Lecture: 6</p>
            <a href="#" class="view-details" onclick="handleSessionDetails(6);">View Details</a>
        </div>

    </section>

    <!-- Footer -->
    <footer>
        <h2>Contact Us</h2>
        <p><i class="fas fa-envelope"></i> Email: support@studyisfunny.com</p>
        <p><i class="fas fa-phone-alt"></i> Phone: 01558145450</p>
    </footer>

    <script>
        // Define the mapping of session numbers to their specific Google Script URLs
        const googleScriptUrls = {
            1: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_1/exec",
            2: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_2/exec",
            3: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_3/exec",
            4: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_4/exec",
            5: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_5/exec",
            6: "https://script.google.com/macros/s/YOUR_SCRIPT_URL_6/exec"
        };

        // Handle Session Details
        function handleSessionDetails(sessionNumber) {
            const userPhone = localStorage.getItem("userPhone");
            
            // Demo mode - bypass authentication if no phone
            if (!userPhone) {
                console.log("Demo mode: No phone number, redirecting to session");
                gosession(sessionNumber);
                return;
            }

            const sessionUrl = googleScriptUrls[sessionNumber];
            if (!sessionUrl) {
                alert(`No URL found for session ${sessionNumber}`);
                return;
            }
            
            // Demo mode - bypass API check if using placeholder URLs
            if (sessionUrl.includes('YOUR_SCRIPT_URL')) {
                console.log("Demo mode: Using placeholder URL, redirecting to session");
                gosession(sessionNumber);
                return;
            }
            
            document.getElementById('loadingSpinner').style.display = 'flex';

            fetch(`${sessionUrl}?code=${userPhone}&session=${sessionNumber}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(`Response for session ${sessionNumber}:`, data);
                    const contentContainer = document.querySelector(".popup-content");
                    document.querySelector(".overlay").style.display = "block";
                    document.querySelector(".popup").style.display = "block";

                    if (data.error) {
                        contentContainer.innerHTML = `
    <div class="first" style="text-align: center; font-family: Arial, sans-serif;  border: 2px solid #008080; border-radius: 10px; background-color: #FFFFE0; max-width: 90%; margin: 0 auto;">
        <h2 class="no" style="color: #2F4F4F;">Subscription Required</h2>
        <p class="no" style="color: #2F4F4F; font-size: 16px;">
            You are not subscribed to this Lecture. Please subscribe to gain access to the materials.
        </p>
        <div class="second" style="text-align: center; font-family: Arial, sans-serif; ">
            <h2 style="color: #2F4F4F;">Let's Subscribe and Buy the Session!</h2>
            <p style="color: #2F4F4F; font-size: 16px; margin-bottom: 20px;">
                You can subscribe and buy the session from here. Click one of the options below to proceed.
            </p>
            <button 
                onclick="buysession(${sessionNumber})"  
                style="
                    padding: 10px 20px;
                    font-size: 16px;
                    cursor: pointer;
                    background-color: #008080;
                    color: #FFFFE0;
                    border: none;
                    border-radius: 5px;
                    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                    margin-bottom: 10px;
                    width: 80%;
                    max-width: 250px;
                "
            >
                I Have a Code
            </button>
            <br>
            <button 
                onclick="window.open('https://wa.me/201000733148', '_blank')" 
                style="
                    padding: 10px 20px;
                    font-size: 16px;
                    cursor: pointer;
                    background-color: #25D366;
                    color: white;
                    border: none;
                    border-radius: 5px;
                    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                    width: 80%;
                    max-width: 250px;
                "
            >
                Donâ€™t Have a Code? Contact Us
            </button>
        </div>
    </div>

    <style>
        .first {
        padding: 20px;
        }
        .second {
        padding: 20px;
        }
        @media screen and (max-width: 768px) {
        .popup {
        padding:0px;
        }
        .first {
        padding:0px;
        }
        .second {
        padding:0px;
        }
            .none {
                padding: 15px; /* Adjust padding for mobile */
                max-width: 100%; /* Make the popup wider */
                width: 90%; /* Ensure it's wider on mobile */
                margin: 0 auto;
            }

            h2 {
                font-size: 20px; /* Smaller font size for better fitting */
            }

            p {
                font-size: 14px; /* Adjust paragraph font size */
                margin-bottom: 15px; /* Decrease spacing for compactness */
            }

            button {
                font-size: 14px; /* Adjust button font size */
                padding: 12px 24px; /* Make buttons a bit wider */
                width: 90%; /* Make buttons fill more of the available space */
                max-width: 320px; /* Increase button width for mobile */
                margin-bottom: 12px; /* Adjust space between buttons */
            }
        }

        @media screen and (max-width: 480px) {
        
        .first {
        padding:0px;
        }
        .second {
        padding:0px;
        }
            .none {
                padding: 10px; /* Reduce padding even more for small screens */
                max-width: 100%; /* Full width */
                width: 90%; /* Ensure it's fitting well on smaller screens */
            }
            .no{
                display:none;
            }
            h2 {
                font-size: 18px; /* Smaller font size */
            }

            p {
                font-size: 12px; /* Adjust paragraph font size */
            }

            button {
                font-size: 14px; /* Adjust button font size */
                padding: 12px 24px;
                width: 90%; /* Make buttons fill most of the screen */
                max-width: 280px; /* Adjust max-width */
                }
                }
            </style>
        `;
        document.getElementById('loadingSpinner').style.display = 'none';

                    } else {

                        gosession(sessionNumber);

document.getElementById('loadingSpinner').style.display = 'none';

                    }
                })
                .catch(error => {
                    document.getElementById('loadingSpinner').style.display = 'none';

                    console.error(`Error fetching session ${sessionNumber}:`, error);
                    alert("An error occurred while processing your request.");
                });
        }

        function closePopup() {
            document.querySelector(".overlay").style.display = "none";
            document.querySelector(".popup").style.display = "none";
        }

        // Preload session data (disabled for demo mode)
        /*
        for (let i = 1; i <= 10; i++) {
            const userPhone = localStorage.getItem("userPhone");
            if (userPhone) {
                const sessionUrl = googleScriptUrls[i];
                fetch(`${sessionUrl}?code=${userPhone}&session=${i}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log(`Session ${i} preload data:`, data);
                        localStorage.setItem(`lecture_${i}`, data.error ? "Unsubscribed" : "Subscribed");
                    });
            }
        }
        */


        //testing the function to buy
        function buysession(sessionNumber){
            location.href = `../buySession${sessionNumber}.html`;
        }
        function gosession(sessionNumber){
            location.href = `../videos/session.html?session=${sessionNumber}`;
        }
    </script>
</body>


</html>
